/**
 * Api to build the XML Request.
 *
 * TODO In case we add more XML based vulnerabilities
 * we will make this Api more generic by building it on Map/Json
 * and also move this to Vulnerability.js.
 */
let buildXmlRequest = function (
  bookName,
  author,
  isbn,
  publisher,
  otherComments
) {
  let xmlRequestDocument = document.implementation.createDocument("", "", null);
  let bookElement = xmlRequestDocument.createElement("book");
  let bookNameElement = xmlRequestDocument.createElement("name");
  bookNameElement.innerHTML = bookName;
  bookElement.appendChild(bookNameElement);

  let authorElement = xmlRequestDocument.createElement("author");
  authorElement.innerHTML = author;
  bookElement.appendChild(authorElement);

  let isbnElement = xmlRequestDocument.createElement("isbn");
  isbnElement.innerHTML = isbn;
  bookElement.appendChild(isbnElement);

  let publisherElement = xmlRequestDocument.createElement("publisher");
  publisherElement.innerHTML = publisher;
  bookElement.appendChild(publisherElement);

  let otherElement = xmlRequestDocument.createElement("others");
  otherElement.innerHTML = otherComments;
  bookElement.appendChild(otherElement);

  xmlRequestDocument.append(bookElement);
  return xmlRequestDocument;
};

function callback(data) {
  document.getElementById("bookInformation").innerText = data.isValid
    ? "Book Details:  \n Name - " +
      data.content.name +
      "\n ISBN - " +
      data.content.isbn +
      "\n Author - " +
      data.content.author +
      "\n Publisher - " +
      data.content.publisher +
      "\n Other information - " +
      data.content.others
    : data.content;
}

let load = function () {
  let url = getUrlForVulnerabilityLevel();
  let bookName = document.getElementById("name").value;
  let author = document.getElementById("author").value;
  let isbn = document.getElementById("isbn").value;
  let publisher = document.getElementById("publisher").value;
  let otherComments = document.getElementById("otherComments").value;
  let xmlRequest = buildXmlRequest(
    bookName,
    author,
    isbn,
    publisher,
    otherComments
  );
  doPostAjaxCall(callback, url, true, xmlRequest);
};

function addingEventListener() {
  document.getElementById("addBook").addEventListener("click", load);
}

function appendResponseCallback(data) {
  document.getElementById("bookInformation").innerHTML = data;
}

addingEventListener();
